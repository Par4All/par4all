<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ext_ehrhart.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.11.1 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ext_ehrhart.c</h1><a href="ext__ehrhart_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00003 <font class="preprocessor">#include &lt;polylib/polylib.h&gt;</font>
<a name="l00004"></a><a class="code" href="ext__ehrhart_8c.html#a0">00004</a> <font class="preprocessor">#define WS 200 </font>
00005 <font class="preprocessor"></font>
00006 <font class="comment">/* #define UE_DEBUG */</font>
00007 
00008 
<a name="l00009"></a><a class="code" href="struct__Polyhedron__union.html">00009</a> <font class="keyword">typedef</font> <font class="keyword">struct </font><a class="code" href="struct__Polyhedron__union.html">_Polyhedron_union</a> { 
<a name="l00010"></a><a class="code" href="struct__Polyhedron__union.html#m0">00010</a>         Enumeration *pt;
<a name="l00011"></a><a class="code" href="struct__Polyhedron__union.html#m1">00011</a>         <font class="keyword">struct </font><a class="code" href="struct__Polyhedron__union.html">_Polyhedron_union</a> *next;} <a class="code" href="struct__Polyhedron__union.html">Polyhedron_union</a>;
00012 
00013 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a2">ppcm1</a> (<font class="keywordtype">int</font> a, <font class="keywordtype">int</font> b);
00014 Matrix *<a class="code" href="ext__ehrhart_8c.html#a3">CalcBase</a>( Matrix *R);
00015 
00016 
00017 <font class="comment">/**** ker.c ****/</font>
00018 
00019 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a4">Soustraire_ligne</a>(Matrix *R, <font class="keywordtype">int</font> l1, <font class="keywordtype">int</font> l2, <font class="keywordtype">int</font> piv );
00020 <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a5">existepivot</a>( Matrix *R, <font class="keywordtype">int</font> l );
00021 <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a6">swap_line</a>(Matrix *R, <font class="keywordtype">int</font> l1, <font class="keywordtype">int</font> l2);
00022 
00023 
00024 <font class="comment">/* Caclule une base du noyau de l'application definie</font>
00025 <font class="comment">par la matrice _carree_ R (completee par des 0..0) */</font>
00026 
00027 <font class="comment">/* /!\ R est alteree par cette fonction. */</font>
00028 
<a name="l00029"></a><a class="code" href="ext__ehrhart_8c.html#a3">00029</a> Matrix *<a class="code" href="ext__ehrhart_8c.html#a3">CalcBase</a>( Matrix *R )<font class="keyword"></font>
00030 <font class="keyword"></font>{
00031         Matrix *B<font class="comment">/*,*BTran*/</font>;   <font class="comment">/* matrice des vect. de la base */</font>
00032         <font class="keywordtype">int</font> i, j;
00033         Value p;
00034         <font class="keywordtype">int</font> l;          <font class="comment">/* ligne en cours de `pivotage' */</font>
00035         <font class="keywordtype">int</font> lnn;
00036         <font class="keywordtype">int</font> dimbase;
00037         <font class="keywordtype">int</font> u;          <font class="comment">/* vecteur util en cours de calcul */</font>
00038         Value  som, t;
00039         <font class="keywordtype">int</font> c;
00040         <font class="comment">/* diagonalisation de R : algo du pivot */</font>
00041         <font class="comment">/* avec conservation des pivots nuls */</font>
00042         <font class="keywordflow">for</font>( l=0 ; l&lt;R-&gt;NbRows ; ++l )
00043         {
00044                 <font class="comment">/* cherche le prochain pivot non nul */</font>
00045                 <font class="keywordflow">if</font>( (lnn=<a class="code" href="ext__ehrhart_8c.html#a5">existepivot</a>(R,l)) != -1 )
00046                 {
00047                         <a class="code" href="ext__ehrhart_8c.html#a6">swap_line</a>( R, l, lnn );
00048 
00049                         <font class="comment">/* met la colonne dessous a 0 */</font>
00050                         <font class="keywordflow">for</font>( j=l+1 ; j&lt;R-&gt;NbRows ; ++j )
00051                                 <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>( R-&gt;p[j][l]) )
00052                                         <a class="code" href="ext__ehrhart_8c.html#a4">Soustraire_ligne</a>( R, l, j, l );
00053 
00054                         <font class="comment">/* et celle dessus aussi */</font>
00055                         <font class="keywordflow">for</font>( j=0 ; j&lt;l ; ++j )
00056                                 <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(R-&gt;p[j][l]) )
00057                                         <a class="code" href="ext__ehrhart_8c.html#a4">Soustraire_ligne</a>( R, l, j, l );
00058 
00059                 }
00060                 <font class="comment">/* s'ils sont tous nuls on passe au suivant */</font>
00061                 <font class="comment">/* en laissant cette ligne inchangee. */</font>
00062         }
00063 
00064         dimbase = 0;
00065         <font class="keywordflow">for</font>( l=0 ; l&lt;R-&gt;NbRows ; ++l )
00066                 <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(R-&gt;p[l][l]) )
00067                         ++dimbase;                      <font class="comment">/* = nb de 0 dans la diagonale */</font>
00068 
00069         B = <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>( dimbase, R-&gt;NbRows );
00070 
00071         l=0;
00072         <font class="keywordflow">for</font>( u=0 ; u&lt;dimbase ; ++u )
00073         {
00074                 <font class="keywordflow">while</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>( R-&gt;p[l][l]) )
00075                         ++l;
00076 
00077         <font class="comment">/* calcul effectif de ce vecteur : chaque coord en commencant par le bas */</font>
00078                 <font class="keywordflow">for</font>( i=R-&gt;NbRows-1 ; i&gt;l ; --i )
00079                         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(B-&gt;p[u][i], 0);
00080                 <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(B-&gt;p[u][l], 1);
00081                 <font class="keywordflow">for</font>( i=l-1 ; i&gt;=0 ; --i )       <font class="comment">/* i=chaque coord du vecteur */</font>
00082                 {
00083                         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>( R-&gt;p[i][i]) )
00084                                 <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(B-&gt;p[u][i],0);             <font class="comment">/* on a deux 0... un seul dans */</font>
00085                                                                         <font class="comment">/* ce vect util suffit */</font>
00086                         <font class="keywordflow">else</font>
00087                         {
00088                                 <font class="comment">/* somme des coef deja calcules * coef dans la matrice */</font>
00089                                 <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(som,0);
00090                                 <a class="code" href="arithmetique_8h.html#a10">value_init</a>( t );
00091                                 <font class="keywordflow">for</font>( c=l ; c&gt;i ; --c )
00092                                 {
00093                                <font class="comment">//som += R-&gt;p[i][c] * B-&gt;p[u][c];</font>
00094                                         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>( t, R-&gt;p[i][c] , B-&gt;p[u][c]);
00095                                         <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(som, som, t );
00096                                         <font class="comment">//B-&gt;p[u][c] *= R-&gt;p[i][i];</font>
00097                                         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(B-&gt;p[u][c] ,B-&gt;p[u][c] , R-&gt;p[i][i]);    
00098                                 }
00099                                 <a class="code" href="arithmetique_8h.html#a14">value_clear</a>( t );
00100                                 <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>(B-&gt;p[u][i] , som );
00101                         }
00102                 }
00103                 <font class="comment">/* reste a faire le pgcd du vecteur et a l'orienter */</font>
00104                 <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p,0);
00105                 <font class="keywordflow">for</font>( i=0 ; i&lt;R-&gt;NbRows ; ++i )
00106                         <font class="comment">//p = pgcd( p, B-&gt;p[u][i] );</font>
00107                         <a class="code" href="vector_8c.html#a3">Gcd</a>( p, B-&gt;p[u][i], &amp;p );
00108                 <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(p))
00109                         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p,1);
00110                 <font class="keywordflow">for</font>( i=0 ; i&lt;R-&gt;NbRows &amp;&amp; <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(B-&gt;p[u][i]); ++i )
00111                         ;
00112                 <font class="keywordflow">if</font>( i&lt;R-&gt;NbRows )
00113                         <font class="keywordflow">if</font>( <a class="code" href="arithmetique_8h.html#a64">value_neg_p</a>(B-&gt;p[u][i]) )
00114                                 <font class="comment">//p = -p;</font>
00115                       <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>( p,p );
00116 
00117                 <font class="keywordflow">for</font>( i=0 ; i&lt;R-&gt;NbRows ; ++i )
00118                         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(B-&gt;p[u][i],B-&gt;p[u][i], p);
00119 
00120                 <font class="comment">/* incrementer le compteur de lignes */</font>
00121                 ++l;
00122         }
00123        <font class="comment">// BTran=Transpose(B);</font>
00124         <font class="comment">//Matrix_Free(B);</font>
00125         <font class="keywordflow">return</font> B;
00126 }
00127 
00128 
00129 <font class="comment">/* fonction qui calcule les vect generateurs de l'espace vectoriel</font>
00130 <font class="comment">        contenant le polyhedre P */</font>
00131 <font class="comment">/*</font>
00132 <font class="comment">Matrix *CalcPolyhedronBase( Polyhedron *P )</font>
00133 <font class="comment">{</font>
00134 <font class="comment">        Matrix *R;</font>
00135 <font class="comment">        Matrix *B;</font>
00136 <font class="comment">        int n, lines;</font>
00137 <font class="comment"></font>
00138 <font class="comment">        if( emptyQ(P) )</font>
00139 <font class="comment">                return( Matrix_Alloc( 0, P-&gt;Dimension ) ); // pas de vect. gen </font>
00140 <font class="comment"></font>
00141 <font class="comment">        R = Matrix_Alloc( P-&gt;Dimension, P-&gt;Dimension );</font>
00142 <font class="comment"></font>
00143 <font class="comment">         // recopie le 'lineality space' du polyedre dans la matrice R </font>
00144 <font class="comment">        for( lines=0,n=0 ; n&lt;P-&gt;NbConstraints ; ++n )</font>
00145 <font class="comment">        {</font>
00146 <font class="comment">                if( P-&gt;Constraint[n][0]==0 )</font>
00147 <font class="comment">                // c'est une direction definissant un ss-espace </font>
00148 <font class="comment">                {</font>
00149 <font class="comment">                        memcpy( &amp;R-&gt;p[lines][0], &amp;P-&gt;Constraint[n][1],</font>
00150 <font class="comment">                                        sizeof(int)*P-&gt;Dimension );</font>
00151 <font class="comment">                        ++lines;</font>
00152 <font class="comment">                }</font>
00153 <font class="comment">        }</font>
00154 <font class="comment">        // remplit le reste de 0..0 </font>
00155 <font class="comment">        for( ; lines&lt;R-&gt;NbRows ; ++lines )</font>
00156 <font class="comment">                memset( &amp;R-&gt;p[lines][0], 0, sizeof(int)*P-&gt;Dimension );</font>
00157 <font class="comment"></font>
00158 <font class="comment">        B = CalcBase( R );</font>
00159 <font class="comment">        Matrix_Free( R );</font>
00160 <font class="comment"></font>
00161 <font class="comment">        return( B );</font>
00162 <font class="comment">}*/</font>
00163 
00164 
00165 <font class="comment">/* fonction qui calcule l'espace vectoriel non parametre de dimension dim</font>
00166 <font class="comment">        contenant le polyhedre parametre P */</font>
00167 <font class="comment">/* les _egalites_ sont stockees par la polylib sous forme triangulaire</font>
00168 <font class="comment">superieure donc il suffit de prendre les premieres. */</font>
00169 
00170 <font class="comment">/*Matrix *CalcEVPolyhedronNP( Polyhedron *P, int dim )</font>
00171 <font class="comment">{</font>
00172 <font class="comment">        Matrix *R;</font>
00173 <font class="comment">        Matrix *B;</font>
00174 <font class="comment">        int n, lines;</font>
00175 <font class="comment"></font>
00176 <font class="comment">        if( emptyQ(P) ) // pas de vect. gen </font>
00177 <font class="comment">        {</font>
00178 <font class="comment">                B = Matrix_Alloc( 1, dim );     //on ne peut pas allouer 0 lignes ! </font>
00179 <font class="comment">                B-&gt;NbRows = 0;</font>
00180 <font class="comment">                return( B );</font>
00181 <font class="comment">        }</font>
00182 <font class="comment"></font>
00183 <font class="comment">        R = Matrix_Alloc( dim, dim );</font>
00184 <font class="comment"></font>
00185 <font class="comment">        // recopie le 'lineality space' du polyedre dans la matrice R </font>
00186 <font class="comment">        for( lines=0,n=0 ; n&lt;P-&gt;NbConstraints &amp;&amp; lines&lt;dim ; ++n )</font>
00187 <font class="comment">        {</font>
00188 <font class="comment">                if( P-&gt;Constraint[n][0]==0 )</font>
00189 <font class="comment">                // c'est une direction definissant un ss-espace </font>
00190 <font class="comment">                {</font>
00191 <font class="comment">                        memcpy( &amp;R-&gt;p[lines][0], &amp;P-&gt;Constraint[n][1],</font>
00192 <font class="comment">                                        sizeof(int)*P-&gt;Dimension );</font>
00193 <font class="comment">                        ++lines;</font>
00194 <font class="comment">                }</font>
00195 <font class="comment">        }</font>
00196 <font class="comment">        // remplit le reste de 0..0 </font>
00197 <font class="comment">        for( ; lines&lt;R-&gt;NbRows ; ++lines )</font>
00198 <font class="comment">                memset( &amp;R-&gt;p[lines][0], 0, sizeof(int)*dim );</font>
00199 <font class="comment"></font>
00200 <font class="comment">        B = CalcBase( R );</font>
00201 <font class="comment">        Matrix_Free( R );</font>
00202 <font class="comment"></font>
00203 <font class="comment">        return( B );</font>
00204 <font class="comment">}*/</font>
00205 
00206 <font class="comment">/* renvoie la ligne sur laquelle on a trouve un coef non nul */</font>
00207 <font class="comment">/* pareil mais cherche dans toutes les lignes */</font>
00208 <font class="comment">/* et -1 s'il n'y en a pas. */</font>
<a name="l00209"></a><a class="code" href="ext__ehrhart_8c.html#a5">00209</a> <font class="keyword">static</font> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a5">existepivot</a>( Matrix *R, <font class="keywordtype">int</font> l )<font class="keyword"></font>
00210 <font class="keyword"></font>{
00211         <font class="keywordtype">int</font> j, c;
00212 
00213         <font class="keywordflow">for</font>( j=l ; j&lt;R-&gt;NbRows ; ++j )
00214                 <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>( R-&gt;p[j][l]) )
00215                         <font class="keywordflow">return</font>( j );
00216 
00217         <font class="comment">/* on ne l'a pas trouve pour l'instant... on cherche au dessus */</font>
00218         <font class="comment">/* les lignes ayant que des 0 jusqu'a la position l */</font>
00219         <font class="keywordflow">for</font>( j=0 ; j&lt;l ; ++j )
00220         {
00221                 <font class="keywordflow">for</font>( c=0 ; c&lt;l &amp;&amp; <a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(R-&gt;p[j][c]) ; c++ )
00222                         ;
00223                 <font class="keywordflow">if</font>( c==l &amp;&amp; <a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(R-&gt;p[j][l]) )
00224                         <font class="keywordflow">return</font>( j );
00225         }
00226 
00227         <font class="keywordflow">return</font>( -1 );
00228 }
00229 
00230 
00231 <font class="comment">/* echange les lignes l1 et l2 dans la matrice R */</font>
<a name="l00232"></a><a class="code" href="ext__ehrhart_8c.html#a6">00232</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a6">swap_line</a>(Matrix *R, <font class="keywordtype">int</font> l1, <font class="keywordtype">int</font> l2)<font class="keyword"></font>
00233 <font class="keyword"></font>{
00234         <font class="keywordtype">int</font> i;
00235         Value  tmp;
00236 
00237         <font class="keywordflow">if</font>( l1 != l2 )
00238                 <font class="keywordflow">for</font>(i = 0;i &lt; R-&gt;NbColumns;i ++)
00239                 {
00240                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(tmp , R-&gt;p[l1][i]);
00241                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(R-&gt;p[l1][i] , R-&gt;p[l2][i]);
00242                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(R-&gt;p[l2][i] , tmp);
00243                 }
00244 }
00245 
00246 
00247 
<a name="l00248"></a><a class="code" href="ext__ehrhart_8c.html#a7">00248</a> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a7">pgcd1</a>( <font class="keywordtype">int</font> a, <font class="keywordtype">int</font> b)<font class="keyword"></font>
00249 <font class="keyword"></font>{
00250  <font class="keywordtype">int</font> r;
00251  <font class="keywordflow">if</font>( a== 0 )
00252  <font class="keywordflow">return</font>( abs(b) );
00253   <font class="keywordflow">if</font>(b==0 )
00254   <font class="keywordflow">return</font>(abs(a) );
00255   <font class="keywordflow">do</font>
00256   {
00257     r= a % b; 
00258     a= b;
00259    b = r;
00260    }
00261    <font class="keywordflow">while</font> ( r!=0 );
00262  <font class="keywordflow">return</font>(abs(a));
00263 }
00264 
00265 
00266 
00267 
00268 <font class="comment">/* Soustraire la ligne l1 de l2 */</font>
00269 <font class="comment">/* On effectue l2 = (l1[piv]/pgcd)*l2 - l1 * (l2[piv]/pgcd) */</font>
<a name="l00270"></a><a class="code" href="ext__ehrhart_8c.html#a4">00270</a> <font class="keyword">static</font> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a4">Soustraire_ligne</a>(Matrix *R, <font class="keywordtype">int</font> l1, <font class="keywordtype">int</font> l2, <font class="keywordtype">int</font> piv )<font class="keyword"></font>
00271 <font class="keyword"></font>{
00272         <font class="keywordtype">int</font> i;
00273         Value  a, b, p, t;
00274         <font class="comment">/* l2 = a*l2 - b*l1 */</font>
00275 
00276         <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(R-&gt;p[l2][piv] ))               <font class="comment">/* c'est deja fait ! */</font>
00277                 <font class="keywordflow">return</font>;
00278 
00279         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a);
00280         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(b);
00281         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(p);
00282         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(t);
00283 
00284         <a class="code" href="vector_8c.html#a3">Gcd</a>( R-&gt;p[l1][piv], R-&gt;p[l2][piv], &amp;p );
00285         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a, R-&gt;p[l1][piv] , p);
00286         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(b , R-&gt;p[l2][piv] , p);
00287 
00288         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(R-&gt;p[l2][piv] , 0);
00289         <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(p,0);
00290         <font class="keywordflow">for</font>(i = piv + 1;i &lt; R-&gt;NbColumns;i ++)
00291         {
00292                 <font class="comment">//R-&gt;p[l2][i] = a*R-&gt;p[l2][i] - b*R-&gt;p[l1][i];</font>
00293                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(t,b,R-&gt;p[l1][i]);
00294                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(R-&gt;p[l2][i],a,R-&gt;p[l2][i]);
00295                 <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(R-&gt;p[l2][i],R-&gt;p[l2][i],t);
00296                 <font class="comment">//p = pgcd( p, R-&gt;p[l2][i] );</font>
00297                 <a class="code" href="vector_8c.html#a3">Gcd</a>(p, R-&gt;p[l2][i], &amp;p );
00298         }
00299         <font class="comment">/* Simplification par le pgcd de toute la ligne */</font>
00300         <font class="keywordflow">for</font>( i=piv+1 ; i&lt;R-&gt;NbColumns &amp;&amp; p!=0 ; i++ )
00301                 <a class="code" href="arithmetique_8h.html#a51">value_division</a>(R-&gt;p[l2][i],R-&gt;p[l2][i], p);
00302 
00303         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a);
00304         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(b);
00305         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(p);
00306         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(t);
00307 }
00308 
00309 
00310 <font class="comment">/*** ext_ehrhart.c ****/</font>
00311 
00312 
<a name="l00313"></a><a class="code" href="ext__ehrhart_8c.html#a8">00313</a> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(evalue *e1,evalue *res)<font class="keyword"> </font>{
00314 <font class="keywordtype">int</font> i, p, x, y;
00315 
00316 evalue *ne;
00317 Value g,m1,m2;
00318 
00319   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(g);
00320   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m1);
00321   <a class="code" href="arithmetique_8h.html#a10">value_init</a>(m2);
00322     <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(e1-&gt;d) &amp;&amp; value_notzero_p(res-&gt;d))<font class="keyword"> </font>{
00323          <font class="comment">/* Add two rational numbers*/</font>
00324          <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m1,e1-&gt;x.n,res-&gt;d);
00325          <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(m2,res-&gt;x.n,e1-&gt;d);
00326          <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(res-&gt;x.n,m1,m2);
00327          <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(res-&gt;d,e1-&gt;d,res-&gt;d);
00328          <a class="code" href="vector_8c.html#a3">Gcd</a>(res-&gt;x.n,res-&gt;d,&amp;g);
00329          <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(g))<font class="keyword"> </font>{
00330               <a class="code" href="arithmetique_8h.html#a51">value_division</a>(res-&gt;d,res-&gt;d,g);
00331               <a class="code" href="arithmetique_8h.html#a51">value_division</a>(res-&gt;x.n,res-&gt;x.n,g);
00332          }
00333          <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00334          <font class="keywordflow">return</font> ;
00335      }
00336      <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(e1-&gt;d) &amp;&amp; value_zero_p(res-&gt;d))<font class="keyword"> </font>{
00337               <font class="keywordflow">if</font> (res-&gt;x.p-&gt;type==polynomial) {
00338                   <font class="comment">/* Add the constant to the constant term of a polynomial*/</font>
00339                    <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(e1, &amp;res-&gt;x.p-&gt;arr[0]);
00340                    <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00341                    <font class="keywordflow">return</font> ;
00342               }
00343               <font class="keywordflow">else</font> <font class="keywordflow">if</font> (res-&gt;x.p-&gt;type==periodic) {
00344                           <font class="comment">/* Add the constant to all elements of a periodic number */</font>
00345                           <font class="keywordflow">for</font> (i=0; i&lt;res-&gt;x.p-&gt;size; i++) {
00346                               <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(e1, &amp;res-&gt;x.p-&gt;arr[i]);
00347                           }
00348                           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00349                              
00350                           <font class="keywordflow">return</font> ;
00351                     } 
00352                     <font class="keywordflow">else</font> {
00353                             fprintf(stderr, <font class="stringliteral">"eadd: cannot add const with vector\n"</font>);
00354                             <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00355                         
00356                             <font class="keywordflow">return</font>;
00357                     }
00358      }
00359      <font class="comment">// ######### add polynomial or periodic to constant #############</font>
00360      <font class="comment">//you have to exchange e1 and res, before doing addition </font>
00361      <font class="comment">//</font>
00362      <font class="keywordflow">else</font> <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(e1-&gt;d) &amp;&amp; value_notzero_p(res-&gt;d))<font class="keyword"> </font>{
00363               enode *tmp;
00364               evalue x;
00365               x=*res;
00366               tmp= <a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(e1-&gt;x.p);
00367               <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>( res-&gt;d, 0 );
00368               res-&gt;x.p=tmp;
00369 
00370               <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;x,res);
00371               <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00372               <font class="keywordflow">return</font> ;
00373      }
00374      <font class="keywordflow">else</font> {   <font class="comment">// ((e1-&gt;d==0) &amp;&amp; (res-&gt;d==0)) </font>
00375                  <font class="keywordflow">if</font> ((e1-&gt;x.p-&gt;type != res-&gt;x.p-&gt;type) ) {
00376                       <font class="comment">// ##### adding to evalues of different type. two cases are possible  #### </font>
00377                       
00378                       <font class="comment">//  #### res is periodic and e1 is polynomial, you have to exchange</font>
00379                       <font class="comment">//e1 and res then to add e1 to the constant term of res  ####</font>
00380                      <font class="keywordflow">if</font> ((res-&gt;x.p-&gt;type == periodic)&amp;&amp;(e1-&gt;x.p-&gt;type == polynomial)) {
00381                        
00382                           evalue eval;
00383                           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>( eval.d, 0 );
00384                           eval.x.p=<a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(res-&gt;x.p);
00385                           res-&gt;x.p= <a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(e1-&gt;x.p);
00386                           <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;eval,&amp;res-&gt;x.p-&gt;arr[0]);
00387                                                              
00388                      }
00389                      <font class="keywordflow">else</font> <font class="keywordflow">if</font> ((res-&gt;x.p-&gt;type == polynomial)&amp;&amp;(e1-&gt;x.p-&gt;type == periodic)) {
00390                           <font class="comment">// #### res is polynomial and e1 is periodic,</font>
00391                           <font class="comment">//  add e1 to the constant term of res  ####</font>
00392                          
00393                           <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(e1,&amp;res-&gt;x.p-&gt;arr[0]);
00394                      }
00395                                  
00396                      <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00397                      <font class="keywordflow">return</font>;
00398                  }
00399                  <font class="keywordflow">else</font> <font class="keywordflow">if</font> (e1-&gt;x.p-&gt;pos  != res-&gt;x.p-&gt;pos ) { 
00400                  <font class="comment">// ### adding evalues of different position (i.e function of different unknowns</font>
00401                  <font class="comment">// to case are possible  ###</font>
00402                            
00403                          <font class="keywordflow">if</font> (res-&gt;x.p-&gt;type == polynomial) {<font class="comment">//  ### res and e1 are polynomials</font>
00404                                <font class="comment">//  add e1 to the constant term of res</font>
00405                                
00406                                <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(e1,&amp;res-&gt;x.p-&gt;arr[0]);
00407                                <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00408                                <font class="keywordflow">return</font>;
00409                           }
00410                           <font class="keywordflow">else</font> {  <font class="comment">// ### res and e1 are pointers to periodic numbers</font>
00411                                    <font class="comment">//add e1 to all elements of res </font>
00412                                    
00413                                   <font class="keywordflow">for</font> (i=0;i&lt;res-&gt;x.p-&gt;size;i++) {
00414                                        <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(e1,&amp;res-&gt;x.p-&gt;arr[i]);
00415                                   }
00416                                   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00417                                   <font class="keywordflow">return</font>;
00418                           }
00419                  
00420                                           
00421                  }  <font class="comment">//###</font>
00422                  
00423                 
00424                  <font class="comment">//same type , same pos  and same size</font>
00425                  <font class="keywordflow">if</font> (e1-&gt;x.p-&gt;size == res-&gt;x.p-&gt;size) {
00426                       <font class="comment">// add any element in e1 to the corresponding element in res </font>
00427                       <font class="keywordflow">for</font> (i=0; i&lt;res-&gt;x.p-&gt;size; i++) {
00428                             <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;e1-&gt;x.p-&gt;arr[i], &amp;res-&gt;x.p-&gt;arr[i]);
00429                       }
00430                       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00431                       <font class="keywordflow">return</font> ;
00432                 }
00433                 
00434                 <font class="comment">/* Sizes are different */</font>
00435                 <font class="keywordflow">if</font> (res-&gt;x.p-&gt;type==polynomial) {
00436                     <font class="comment">/* VIN100: if e1-size &gt; res-size you have to copy e1 in a   */</font>
00437                     <font class="comment">/* new enode and add res to that new node. If you do not do */</font>
00438                     <font class="comment">/* that, you lose the the upper weight part of e1 !         */</font>
00439 
00440                      <font class="keywordflow">if</font>(e1-&gt;x.p-&gt;size &gt; res-&gt;x.p-&gt;size) {
00441                           enode *tmp;
00442                           tmp = <a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(e1-&gt;x.p);
00443                           <font class="keywordflow">for</font>(i=0;i&lt;res-&gt;x.p-&gt;size;++i) {
00444                               <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;res-&gt;x.p-&gt;arr[i], &amp;tmp-&gt;arr[i]);
00445                               <font class="comment">//  free_evalue_refs(&amp;res-&gt;x.p-&gt;arr[i]);</font>
00446                           }
00447                           res-&gt;x.p = tmp;
00448           
00449                      }
00450                      <font class="keywordflow">else</font> {
00451                      
00452                         <font class="keywordflow">for</font> (i=0; i&lt;e1-&gt;x.p-&gt;size ; i++) {
00453                              <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;e1-&gt;x.p-&gt;arr[i], &amp;res-&gt;x.p-&gt;arr[i]);
00454                         } 
00455                         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00456                                    
00457                         <font class="keywordflow">return</font> ;
00458                      } 
00459                 }
00460                 
00461     <font class="comment">// ### add two periodics of the same pos (unknown) but whith different sizes (periods) ###</font>
00462                 <font class="keywordflow">else</font> <font class="keywordflow">if</font> (res-&gt;x.p-&gt;type==periodic) {
00463                       <font class="comment">/* you have to create a new evalue 'ne' in whitch size equals to the scm</font>
00464 <font class="comment">                       of the sizes of e1 and res, then to copy res periodicaly in ne, after</font>
00465 <font class="comment">                       to add periodicaly elements of e1 to elements of ne, and finaly to </font>
00466 <font class="comment">                       return ne. */</font>
00467                                                     
00468                        x=e1-&gt;x.p-&gt;size;
00469                        y= res-&gt;x.p-&gt;size;
00470                        p=<a class="code" href="ext__ehrhart_8c.html#a2">ppcm1</a>(x,y);
00471                        ne= (evalue *) malloc (<font class="keyword">sizeof</font>(evalue)); 
00472                        <a class="code" href="arithmetique_8h.html#a10">value_init</a>(ne-&gt;d);
00473                        <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>( ne-&gt;d,0);
00474                                     
00475                        ne-&gt;x.p=<a class="code" href="ehrhart_8c~.html#a7">new_enode</a>(res-&gt;x.p-&gt;type,p, res-&gt;x.p-&gt;pos);
00476                        <font class="keywordflow">for</font>(i=0;i&lt;p;i++)  {
00477                               <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(ne-&gt;x.p-&gt;arr[i].d, res-&gt;x.p-&gt;arr[i%y].d);
00478                               <font class="keywordflow">if</font> (<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(ne-&gt;x.p-&gt;arr[i].d))<font class="keyword">   </font>{
00479                             <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(ne-&gt;x.p-&gt;arr[i].x.n, res-&gt;x.p-&gt;arr[i%y].x.n);
00480                               }
00481                               <font class="keywordflow">else</font> { 
00482                                   ne-&gt;x.p-&gt;arr[i].x.p =<a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(res-&gt;x.p-&gt;arr[i%y].x.p);
00483                               }
00484                        }
00485                        <font class="keywordflow">for</font>(i=0;i&lt;p;i++)  {
00486                             <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;e1-&gt;x.p-&gt;arr[i%x], &amp;ne-&gt;x.p-&gt;arr[i]);
00487                        }
00488       
00489                        res=ne;
00490                     
00491                         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00492                         <font class="keywordflow">return</font> ;
00493                 }
00494                 <font class="keywordflow">else</font> { <font class="comment">/* evector */</font>
00495                      fprintf(stderr, <font class="stringliteral">"eadd: ?cannot add vectors of different length\n"</font>);
00496                      <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00497                      <font class="keywordflow">return</font> ;
00498                 }
00499      }
00500      <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(g); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m1); <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(m2);
00501      <font class="keywordflow">return</font> ;
00502  } <font class="comment">/* new_eadd */</font>
00503    
00504 <font class="comment">// remove the last row and the last column of a matrix Mat</font>
<a name="l00505"></a><a class="code" href="ext__ehrhart_8c.html#a9">00505</a> Matrix *<a class="code" href="ext__ehrhart_8c.html#a9">Reduce_Matrix</a> (Matrix *Mat)<font class="keyword"> </font>{
00506            <font class="keywordtype">int</font> i; 
00507            Value *p;
00508            p=*(Mat-&gt;p+(Mat-&gt;NbRows-1));
00509            <font class="keywordflow">for</font> (i=0;i&lt;Mat-&gt;NbColumns; i++)  {
00510                    <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(*p++);
00511            }
00512            <font class="keywordflow">for</font> (i=0; i&lt;Mat-&gt;NbRows-1; i++)  { 
00513                    p=*(Mat-&gt;p+i);
00514                    <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(*(p+(Mat-&gt;NbColumns-1)));
00515            }
00516            Mat-&gt;NbRows--;
00517            Mat-&gt;NbColumns--;
00518            <font class="keywordflow">return</font> Mat;
00519    } <font class="comment">/* Reduce_Matrix */</font>
00520     
00521   
00522   <font class="comment">/* Computes the scalar product (in euclidien space) of two vectors */</font> 
00523   
<a name="l00524"></a><a class="code" href="ext__ehrhart_8c.html#a10">00524</a> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a10">Scalar_product</a>(Value *p1,Value *p2,<font class="keywordtype">unsigned</font> length, Value *r)<font class="keyword"> </font>{
00525         Value *cp1, *cp2, tmp;
00526         
00527         <font class="keywordtype">int</font> i;
00528           cp1=p1;
00529           cp2=p2;
00530           <a class="code" href="arithmetique_8h.html#a10">value_init</a>(tmp);
00531           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(*r,0);
00532                <font class="keywordflow">for</font> (i=0;i&lt;length;i++) {
00533                  <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(tmp,*cp1,*cp2);                        
00534                  <a class="code" href="arithmetique_8h.html#a43">value_addto</a>(*r,*r,tmp);
00535                   cp1++; cp2++;
00536                }
00537                <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(tmp);
00538   } <font class="comment">/* Scalar_product */</font>
00539 
00540     <font class="comment">/* computes the scm of two integrals  */</font>
00541      
<a name="l00542"></a><a class="code" href="ext__ehrhart_8c.html#a2">00542</a>       <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a2">ppcm1</a> (<font class="keywordtype">int</font> a, <font class="keywordtype">int</font> b)<font class="keyword"> </font>{
00543            <font class="keywordtype">int</font> t;
00544            t = (a*b)/ <a class="code" href="ext__ehrhart_8c.html#a7">pgcd1</a>(a,b);
00545           <font class="keywordflow">return</font> t;
00546        } <font class="comment">/* ppcm1 */</font>
00547   
00548 <font class="comment">/* computes the scm of two values */</font>
00549 
<a name="l00550"></a><a class="code" href="ext__ehrhart_8c.html#a11">00550</a> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a11">ppcm</a>(Value a, Value b, Value *r)<font class="keyword"> </font>{
00551         Value g;
00552         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(g); 
00553         <a class="code" href="vector_8c.html#a3">Gcd</a>(a,b,&amp;g);
00554         <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(*r,a,b);
00555         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(*r,*r,g);
00556 } <font class="comment">/* ppcm  */</font>
00557 
00558 
<a name="l00559"></a><a class="code" href="ext__ehrhart_8c.html#a12">00559</a>    Matrix *<a class="code" href="ext__ehrhart_8c.html#a12">Orthogonal_Base</a>(Matrix *Mat)<font class="keyword">  </font>{
00560      Matrix *OrthMat;
00561      Value a,b,c,d;
00562      Vector *q,*p,*f;
00563      <font class="keywordtype">unsigned</font> length;
00564      <font class="keywordtype">int</font> i,j,k;
00565      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(a);
00566      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(b);
00567      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(c);
00568      <a class="code" href="arithmetique_8h.html#a10">value_init</a>(d);
00569      OrthMat= <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(Mat-&gt;NbRows,Mat-&gt;NbColumns);
00570      length=Mat-&gt;NbColumns;
00571         <font class="keywordflow">for</font>(k=0; k&lt;length; k++)  {
00572                <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(OrthMat-&gt;p[0][k],Mat-&gt;p[0][k]);             
00573       }
00574         f=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(length);
00575         p=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(length);
00576         q=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(length);
00577         <font class="keywordflow">for</font>(i=1; i&lt;Mat-&gt;NbRows; i++)  {
00578               <font class="keywordflow">for</font>(k=0;k&lt;length;k++)  {
00579                    <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(f-&gt;p[k],Mat-&gt;p[i][k]);
00580                    <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(q-&gt;p[k],Mat-&gt;p[i][k]);
00581               }
00582               <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>(d,1);
00583               <font class="keywordflow">for</font>(j=0; j&lt;i; j++) {
00584                      <font class="keywordflow">for</font>(k=0;k&lt;length;k++)  {
00585                       <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(p-&gt;p[k],OrthMat-&gt;p[j][k]);
00586                      }
00587                   
00588                 <a class="code" href="ext__ehrhart_8c.html#a10">Scalar_product</a>(p-&gt;p,f-&gt;p,length,&amp;a);
00589                 <a class="code" href="ext__ehrhart_8c.html#a10">Scalar_product</a>(p-&gt;p,p-&gt;p,length,&amp;b);    
00590                 <a class="code" href="vector_8c.html#a3">Gcd</a>(a,b,&amp;c);
00591                 <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a,a,c);
00592                 <a class="code" href="arithmetique_8h.html#a51">value_division</a>(b,b,c);
00593                 <font class="keywordflow">for</font>(k=0;k&lt;length;k++) {
00594                    <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(p-&gt;p[k],p-&gt;p[k],a);
00595                 }
00596                                 
00597                 <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(d)|<a class="code" href="arithmetique_8h.html#a70">value_notone_p</a>(b))<font class="keyword">  </font>{
00598                         <a class="code" href="ext__ehrhart_8c.html#a11">ppcm</a>(d,b,&amp;c);
00599                         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(a,c,b);
00600                         <a class="code" href="arithmetique_8h.html#a51">value_division</a>(b,c,d);
00601                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(d,c);
00602                         <font class="keywordflow">for</font>(k=0;k&lt;length;k++) {
00603                                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(p-&gt;p[k],p-&gt;p[k],a);
00604                                 <a class="code" href="arithmetique_8h.html#a47">value_multiply</a>(q-&gt;p[k],q-&gt;p[k],b);
00605                         }
00606 
00607                 }
00608                                   
00609                    <font class="keywordflow">for</font>(k=0;k&lt;length;k++) {
00610                        <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(q-&gt;p[k],q-&gt;p[k],p-&gt;p[k]);
00611                    }
00612                                 
00613             }
00614              <a class="code" href="vector_8c.html#a23">Vector_Gcd</a>(q-&gt;p,length,&amp;c); 
00615              <font class="keywordflow">for</font>(k=0;k&lt;length;k++) {
00616                  <a class="code" href="arithmetique_8h.html#a51">value_division</a>(OrthMat-&gt;p[i][k],q-&gt;p[k],c);
00617              }
00618           
00619         }
00620         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(a);
00621         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(b);
00622         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(c);
00623         <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(d);
00624         <font class="keywordflow">return</font> OrthMat;
00625   }  <font class="comment">/* Orthogaunal_Base  */</font>
00626      
00627 
00628   <font class="comment">// Remove an element of à list  </font>
<a name="l00629"></a><a class="code" href="ext__ehrhart_8c.html#a13">00629</a>   <font class="keywordtype">void</font>  <a class="code" href="ext__ehrhart_8c.html#a13">Remove_Element</a>(Enumeration *en,Enumeration **re, Enumeration *prev)<font class="keyword">  </font>{
00630           <font class="keywordflow">if</font> (en== *re)  {
00631                   *re= (*re)-&gt;next;
00632           }
00633           <font class="keywordflow">else</font> {
00634                   prev-&gt;next=en-&gt;next;
00635           }
00636   } <font class="comment">/* Remove_Element */</font>
00637   
00638  <font class="comment">/* Remove validite domains and correspending ehrhart polynomials whitch are redundant after </font>
00639 <font class="comment">  the enumeration of a polyhedron */</font>
00640 
<a name="l00641"></a><a class="code" href="ext__ehrhart_8c.html#a14">00641</a>  <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a14">Remove_RedundantDomains</a> (Enumeration  **Ures)<font class="keyword">  </font>{
00642         Enumeration *ren1, *ren2, *previous=NULL;
00643         <font class="keywordtype">int</font> red;
00644         <font class="keywordflow">for</font> (ren1=*Ures; ren1; ren1=ren1-&gt;next)  {
00645                 red=0;
00646                 <font class="keywordflow">for</font> (ren2=*Ures; ren2; ren2=ren2-&gt;next)  {
00647                         <font class="keywordflow">if</font> (ren1!=ren2)  {
00648                                   
00649                             <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(ren2-&gt;ValidityDomain, ren1-&gt;ValidityDomain))<font class="keyword"> </font>{
00650                                         red= 1;
00651                                         <font class="keywordflow">break</font>;
00652                 
00653                                 }
00654                                 
00655                         }
00656                 }
00657                 <font class="keywordflow">if</font> (red)  {
00658                         <a class="code" href="ext__ehrhart_8c.html#a13">Remove_Element</a>(ren1,Ures,previous);
00659                 }
00660                 previous=ren1;
00661         }
00662  }<font class="comment">/*Remove_RedendentDomains */</font>
00663                                                       
00664                                   
<a name="l00665"></a><a class="code" href="ext__ehrhart_8c.html#a15">00665</a> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a15">IncludeInRes</a> (Polyhedron *p, Enumeration *e, <font class="keywordtype">unsigned</font> MR)<font class="keyword"> </font>{
00666         Enumeration *en;
00667            <font class="keywordflow">for</font> (en=e; en; en=en-&gt;next)  {
00668                   
00669                 <font class="keywordflow">if</font> (<a class="code" href="polyhedron_8c.html#a29">PolyhedronIncludes</a>(e-&gt;ValidityDomain,p)) 
00670                          <font class="keywordflow">return</font> 1;
00671            }
00672         <font class="keywordflow">return</font> 0;       
00673 }
00674 
<a name="l00675"></a><a class="code" href="ext__ehrhart_8c.html#a16">00675</a> Polyhedron *<a class="code" href="ext__ehrhart_8c.html#a16">DMUnion</a>(Enumeration *en, <font class="keywordtype">unsigned</font> MR)<font class="keyword">  </font>{
00676         Enumeration *e1;
00677         Polyhedron *d;
00678         e1=en;
00679         d=e1-&gt;ValidityDomain; 
00680          <font class="keywordflow">for</font> (e1=en-&gt;next; e1; e1=e1-&gt;next) {
00681            d= <a class="code" href="polyhedron_8c.html#a44">DomainUnion</a>( d, e1-&gt;ValidityDomain, MR);
00682          }
00683          <font class="keywordflow">return</font> d;
00684   }
00685 
00686 
<a name="l00687"></a><a class="code" href="ext__ehrhart_8c.html#a17">00687</a> <font class="keywordtype">void</font> <a class="code" href="ext__ehrhart_8c.html#a17">AffConstraints</a>(Polyhedron *Poldisj)<font class="keyword"></font>
00688 <font class="keyword"></font>{
00689         Polyhedron *p;
00690 
00691         <font class="keywordflow">for</font>(p=Poldisj;p;p=p-&gt;next)
00692         {
00693                 <a class="code" href="polyhedron_8c.html#a57">Polyhedron_PrintConstraints</a>( stdout, P_VALUE_FMT, p);
00694                 printf(<font class="stringliteral">"\n"</font>);
00695         }
00696 }
<a name="l00697"></a><a class="code" href="ext__ehrhart_8c.html#a18">00697</a> <font class="keywordtype">int</font> <a class="code" href="ext__ehrhart_8c.html#a18">Degenerate</a> (Enumeration *en)<font class="keyword"> </font>{
00698         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a68">value_notzero_p</a>(en-&gt;EP.d))<font class="keyword"> </font>{
00699                 
00700            <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a71">value_mone_p</a>(en-&gt;EP.x.n ))<font class="keyword"> </font>{
00701                <font class="keywordflow">return</font> 1;    
00702            }
00703         }
00704    <font class="keywordflow">return</font> 0;    
00705 }
00706 
00707 <font class="comment">/* Enumeration of a domain D */</font>
00708 
<a name="l00709"></a><a class="code" href="ext__ehrhart_8c.html#a19">00709</a> Enumeration *<a class="code" href="ext__ehrhart_8c.html#a19">Domain_Enumerate</a>(Polyhedron *D, Polyhedron *C, <font class="keywordtype">unsigned</font> <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>,<font class="keywordtype">char</font> **pn)<font class="keyword"></font>
00710 <font class="keyword"></font>{     <a class="code" href="struct__Polyhedron__union.html">Polyhedron_union</a> *Polun,*pu;
00711       Polyhedron  *lp, *lp1, *lp1next;
00712       Polyhedron *d1,*d2,*d;  
00713       Enumeration *e,*pr,*en,*en1, *en2,*tmp, *res, *sen;
00714       Polun=NULL;
00715      
00716      lp = <a class="code" href="polyhedron_8c.html#a56">Disjoint_Domain</a>( D, 0, <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a> );
00717 
00718 <font class="preprocessor">#ifdef UE_DEBUG</font>
00719 <font class="preprocessor"></font>     printf(<font class="stringliteral">"##############################################################\n"</font>);
00720      printf(<font class="stringliteral">"\n###### DISJOINT UNION  ######\n\n"</font>);
00721      <a class="code" href="ext__ehrhart_8c.html#a17">AffConstraints</a>(lp); 
00722      printf(<font class="stringliteral">"##############################################################\n"</font>);
00723 <font class="preprocessor">#endif</font>
00724 <font class="preprocessor"></font>     
00725         <font class="keywordflow">for</font> (lp1=lp ; lp1; lp1=lp1-&gt;next)
00726         {
00727                 lp1next = lp1-&gt;next;
00728                 lp1-&gt;next = NULL;
00729                 en= <a class="code" href="ehrhart_8c~.html#a27">Polyhedron_Enumerate</a>(lp1, C, <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00730                 lp1-&gt;next = lp1next;
00731                 sen= NULL;
00732                 <font class="keywordflow">for</font>(e=en;e;e=e-&gt;next)
00733                         <font class="keywordflow">if</font>(!<a class="code" href="ext__ehrhart_8c.html#a18">Degenerate</a>(e))<font class="keyword"></font>
00734 <font class="keyword">                        </font>{
00735                                 pr = (Enumeration  *)malloc(<font class="keyword">sizeof</font>(Enumeration));
00736                                 pr-&gt;EP=e-&gt;EP;     
00737                                 pr-&gt;ValidityDomain=e-&gt;ValidityDomain;
00738                                 pr-&gt;next=sen;
00739                                 sen=pr;
00740                         }
00741 
00742                 <font class="keywordflow">if</font>(sen!= NULL)
00743                 {
00744                         pu = (<a class="code" href="struct__Polyhedron__union.html">Polyhedron_union</a>  *)malloc(<font class="keyword">sizeof</font>(<a class="code" href="struct__Polyhedron__union.html">Polyhedron_union</a>));
00745                         pu-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>=sen;
00746                         pu-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a> = Polun;
00747                         Polun = pu;
00748                 }
00749         }
00750         <font class="keywordflow">if</font>(!Polun)
00751         {
00752 <font class="preprocessor">#ifdef UE_DEBUG</font>
00753 <font class="preprocessor"></font>                fprintf(stdout,<font class="stringliteral">"Empty Polun\n"</font>);
00754 <font class="preprocessor">#endif</font>
00755 <font class="preprocessor"></font>                <font class="keywordflow">return</font> ((Enumeration *) 0);
00756         }
00757       
00758         <font class="keywordflow">while</font>(Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a> != NULL)  {
00759                 res=NULL;
00760                 en1=Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>;
00761                 en2=(Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>)-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>;
00762 
00763                 d1=<a class="code" href="ext__ehrhart_8c.html#a16">DMUnion</a>(en1, <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00764                 d2=<a class="code" href="ext__ehrhart_8c.html#a16">DMUnion</a>(en2, <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00765 
00766                 <font class="keywordflow">for</font>(en1=Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>;en1;en1=en1-&gt;next)
00767                 {
00768 
00769                         <font class="keywordflow">for</font>(en2=(Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>)-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>;en2;en2=en2-&gt;next)
00770                         {
00771                                 d = <a class="code" href="polyhedron_8c.html#a32">DomainIntersection</a>(en1-&gt;ValidityDomain,en2-&gt;ValidityDomain,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00772                                 <font class="keywordflow">if</font>( d &amp;&amp; !emptyQ(d)&amp;&amp;!<a class="code" href="ext__ehrhart_8c.html#a15">IncludeInRes</a>(d,res,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>))<font class="keyword">  </font>{
00773                                         evalue ev;
00774                                         <a class="code" href="arithmetique_8h.html#a10">value_init</a>(ev.d);
00775                                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>( ev.d, en2-&gt;EP.d );
00776                                         <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(ev.d))
00777                                                 ev.x.p=<a class="code" href="ehrhart_8c~.html#a9">ecopy</a>(en2-&gt;EP.x.p);
00778                                         <font class="keywordflow">else</font>
00779                                         {
00780                                                 <a class="code" href="arithmetique_8h.html#a10">value_init</a>(ev.x.n);
00781                                                 <a class="code" href="arithmetique_8h.html#a11">value_assign</a>( ev.x.n, en2-&gt;EP.x.n );
00782                                         }
00783 
00784                                         <a class="code" href="ext__ehrhart_8c.html#a8">new_eadd</a>(&amp;en1-&gt;EP,&amp;ev);
00785                                         tmp = (Enumeration  *)malloc(<font class="keyword">sizeof</font>(Enumeration));
00786                                         tmp-&gt;ValidityDomain =d;
00787                                         tmp-&gt;EP=ev;
00788                                         tmp-&gt;next= res;
00789                                         res=tmp;
00790                                 }
00791                         }
00792                         d=<a class="code" href="polyhedron_8c.html#a46">DomainDifference</a>(en1-&gt;ValidityDomain,d2 ,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00793                         <font class="keywordflow">if</font>( d &amp;&amp; !emptyQ(d)&amp;&amp;!<a class="code" href="ext__ehrhart_8c.html#a15">IncludeInRes</a>(d,res,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>))<font class="keyword"></font>
00794 <font class="keyword">                        </font>{
00795                                 tmp = (Enumeration  *)malloc(<font class="keyword">sizeof</font>(Enumeration));
00796                                 tmp-&gt;ValidityDomain =d;
00797 
00798                                 tmp-&gt;EP=en1-&gt;EP;
00799                                 tmp-&gt;next= res;
00800                                 res=tmp;
00801                         }
00802                 }
00803                 <font class="keywordflow">for</font>(en2=(Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>)-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>; en2; en2= en2-&gt;next)
00804                 {
00805                         d= <a class="code" href="polyhedron_8c.html#a46">DomainDifference</a>(en2-&gt;ValidityDomain,d1,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00806                         <font class="keywordflow">if</font>( d &amp;&amp; !emptyQ(d)&amp;&amp;!<a class="code" href="ext__ehrhart_8c.html#a15">IncludeInRes</a>(d,res,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>) )<font class="keyword"></font>
00807 <font class="keyword">                        </font>{
00808                                 tmp = (Enumeration  *)malloc(<font class="keyword">sizeof</font>(Enumeration));
00809                                 tmp-&gt;ValidityDomain =d;
00810                                 tmp-&gt;EP=en2-&gt;EP;
00811                                 tmp-&gt;next= res;
00812                                 res=tmp;
00813                         }
00814                 }
00815             
00816                 Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>=res;
00817                                      
00818                 Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>= (Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>)-&gt;<a class="code" href="struct__Polyhedron__union.html#m1">next</a>;
00819         }
00820         res=Polun-&gt;<a class="code" href="struct__Polyhedron__union.html#m0">pt</a>;
00821                 
00822         <a class="code" href="ext__ehrhart_8c.html#a14">Remove_RedundantDomains</a>(&amp;res); 
00823         <font class="keywordflow">return</font>(res);
00824 }
00825 
00826 
00827 <font class="comment">/**********</font>
00828 <font class="comment"> DO NOT USE THE FOLLOWING FUNCTION IT'S NOT WORKING PROPERLY YET.</font>
00829 <font class="comment"> **********/</font>
00830 
00831 <font class="comment">/* Enumeration of the image by T of domain D */</font>
<a name="l00832"></a><a class="code" href="ext__ehrhart_8c.html#a20">00832</a> Enumeration *<a class="code" href="ext__ehrhart_8c.html#a20">Polyhedron_Image_Enumerate</a>(Polyhedron *D,  Polyhedron *C, Matrix *T, <font class="keywordtype">unsigned</font> <a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>, <font class="keywordtype">char</font> **par_name)<font class="keyword"></font>
00833 <font class="keyword"></font>{   Polyhedron *polun,*pol;
00834     Enumeration *ee;
00835     Matrix *TCopy,*Tred, *d1,*d;
00836     Vector *v1,*v2;
00837     Value h;
00838     <font class="keywordtype">int</font> i,j,k;
00839    <a class="code" href="arithmetique_8h.html#a10">value_init</a>(h);
00840     <font class="keywordflow">if</font>(!D) {
00841          fprintf(stdout,<font class="stringliteral">"             Error: in reading input domain \n"</font>);   
00842          <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00843            <font class="keywordflow">return</font> ((Enumeration *) 0);
00844     }
00845     <font class="keywordflow">else</font> {
00846       printf(<font class="stringliteral">"\n ################   INPUT  POLYHEDRON  #######################\n\n"</font>);
00847       <a class="code" href="ext__ehrhart_8c.html#a17">AffConstraints</a>(D);
00848      }
00849 
00850 <font class="preprocessor">#ifdef DOMAIN_IMAGE</font>
00851 <font class="preprocessor"></font>       fpol=<a class="code" href="polyhedron_8c.html#a53">DomainImage</a>(D,T,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00852        printf(<font class="stringliteral">"\n $$$$$$$$$$$$$  THE  DOMAIN IMAGE    $$$$$$$$$$$$$\n\n"</font>);
00853          <a class="code" href="ext__ehrhart_8c.html#a17">AffConstraints</a>(fpol);
00854           <font class="keywordflow">if</font>(emptyQ(fpol))<font class="keyword"> </font>{
00855                   <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00856                   <font class="keywordflow">return</font> ((Enumeration *) 0);
00857           } 
00858           ee = <a class="code" href="ext__ehrhart_8c.html#a19">Domain_Enumerate</a>(fpol,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>,par_name);
00859           <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00860        <font class="keywordflow">return</font>  (ee);
00861 <font class="preprocessor">#endif</font>
00862 <font class="preprocessor"></font> 
00863      TCopy= <a class="code" href="Matop_8c.html#a5">Matrix_Copy</a>(T);
00864      Tred= <a class="code" href="ext__ehrhart_8c.html#a9">Reduce_Matrix</a>(TCopy);
00865      printf(<font class="stringliteral">"\n ##################  INPUT REDUCED TRANSFORMATION MATRIX ##################\n"</font> );
00866      <a class="code" href="matrix_8c.html#a2">Matrix_Print</a>(stdout,P_VALUE_FMT,Tred);
00867 
00868          <font class="keywordflow">if</font> (Tred-&gt;NbRows &lt;Tred-&gt;NbColumns) {
00869                d1=(Matrix *) <a class="code" href="matrix_8c.html#a0">Matrix_Alloc</a>(Tred-&gt;NbColumns,Tred-&gt;NbColumns);
00870                <font class="keywordflow">for</font> (i=0;i&lt;Tred-&gt;NbRows;i++) {
00871                     <font class="keywordflow">for</font> (j=0; j&lt;Tred-&gt;NbColumns;j++) {
00872                                 <a class="code" href="arithmetique_8h.html#a11">value_assign</a>( d1-&gt;p[i][j], Tred-&gt;p[i][j] );
00873                     }
00874                }
00875                <font class="keywordflow">for</font>(i=Tred-&gt;NbRows;i&lt;Tred-&gt;NbColumns;i++) {
00876                      <font class="keywordflow">for</font> (j=0;j&lt;Tred-&gt;NbColumns;j++) {
00877                           <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>( d1-&gt;p[i][j], 0 );
00878                      }
00879                }
00880                d= (Matrix *) <a class="code" href="ext__ehrhart_8c.html#a3">CalcBase</a>(d1);
00881                <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Tred);
00882                <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(d1);
00883          
00884          }
00885          <font class="keywordflow">else</font> {
00886               d=(Matrix *) <a class="code" href="ext__ehrhart_8c.html#a3">CalcBase</a>(Tred);
00887               <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(Tred);
00888          }
00889     <font class="keywordflow">if</font>(d-&gt;NbRows==0) {
00890         <font class="keywordflow">if</font>(emptyQ(D))<font class="keyword"> </font>{
00891                 <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00892                 <font class="keywordflow">return</font> ((Enumeration *) 0);
00893         }
00894         <font class="keywordflow">else</font> {
00895            printf( <font class="stringliteral">"        Ker(A)=0  implys directly Enumeration on input polyhedron\n\n"</font>);            
00896            ee=<a class="code" href="ext__ehrhart_8c.html#a19">Domain_Enumerate</a>(D,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>,par_name);
00897            <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00898            <font class="keywordflow">return</font> ee;
00899         }
00900    }
00901    
00902    d1=<a class="code" href="Matop_8c.html#a4">Transpose</a>(d);
00903    <a class="code" href="matrix_8c.html#a1">Matrix_Free</a>(d);
00904    
00905    <font class="keywordflow">if</font>(d1-&gt;NbRows!=D-&gt;Dimension) {
00906       fprintf(stdout,<font class="stringliteral">"      \n Error: incompatible dimension \n"</font>);
00907       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00908       <font class="keywordflow">return</font> ((Enumeration *) 0);
00909    }
00910    <font class="keywordflow">if</font>(d1-&gt;NbColumns &gt; 1) {
00911  fprintf(stdout,<font class="stringliteral">"   \n Error: Can not compute intégral points : More then vector in ker(A)! \n"</font>);
00912     <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00913     <font class="keywordflow">return</font> ((Enumeration *) 0);
00914          
00915     }
00916    printf( <font class="stringliteral">"           \n Ker(A)=1  implys adding constraints befor Enumeration\n"</font>);
00917    v1=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(d1-&gt;NbRows);
00918    v2=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(d1-&gt;NbRows);
00919    
00920           polun=(Polyhedron *) NULL; 
00921             <font class="keywordflow">for</font> (k=0;k&lt;d1-&gt;NbRows;k++) {
00922                   <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(v1-&gt;p[k],d1-&gt;p[k][0]) ;
00923             }
00924           <font class="comment">/* adding a new constraint for all constraints of D in which the scalar product of the*/</font>
00925           <font class="comment">/* normal whith vector v1 is greter then zero*/</font>
00926             
00927           <font class="keywordflow">for</font> (j=0;j&lt;D-&gt;NbConstraints;j++)  {
00928                  <font class="keywordflow">for</font> (k=0;k&lt;=D-&gt;Dimension-1;k++) {
00929                         <a class="code" href="arithmetique_8h.html#a11">value_assign</a>(v2-&gt;p[k],D-&gt;Constraint[j][k+1]) ;
00930                   }
00931                   <a class="code" href="ext__ehrhart_8c.html#a10">Scalar_product</a>(v1-&gt;p,v2-&gt;p,D-&gt;Dimension,&amp;h);
00932                 
00933                   <font class="keywordflow">if</font>(<a class="code" href="arithmetique_8h.html#a63">value_pos_p</a>(h)&amp;&amp;!<a class="code" href="arithmetique_8h.html#a67">value_zero_p</a>(D-&gt;Constraint[j][0]))<font class="keyword"> </font>{
00934                        Vector *NCont;
00935                        Value val;
00936                        <a class="code" href="arithmetique_8h.html#a10">value_init</a>( val );
00937                        <font class="comment">/* Create a new contraint whitch is added to the polyhedron*/</font>
00938                        
00939                        NCont=<a class="code" href="vector_8c.html#a5">Vector_Alloc</a>(d1-&gt;NbRows+2);
00940                        <a class="code" href="arithmetique_8h.html#a12">value_set_si</a>( NCont-&gt;p[0],1); <font class="comment">// the constraint is an inequalite</font>
00941                                        
00942                        <font class="keywordflow">for</font> (k=1;k&lt;=D-&gt;Dimension;k++) {
00943                             <a class="code" href="arithmetique_8h.html#a54">value_oppose</a>( NCont-&gt;p[k], D-&gt;Constraint[j][k]);
00944                                         }
00945                        <a class="code" href="arithmetique_8h.html#a50">value_decrement</a>(val,h);
00946                        <a class="code" href="arithmetique_8h.html#a48">value_substract</a>(val,val,D-&gt;Constraint[j][D-&gt;Dimension+1]);
00947                        <a class="code" href="arithmetique_8h.html#a11">value_assign</a> (NCont-&gt;p[D-&gt;Dimension+1],val);
00948                        <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(val);
00949                         <font class="comment">//add the new constraint to polyhedron D</font>
00950                        pol=<a class="code" href="polyhedron_8c.html#a28">AddConstraints</a>(NCont-&gt;p,1,D,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>);
00951                        polun=<a class="code" href="polyhedron_8c.html#a30">AddPolyToDomain</a>(<a class="code" href="polyhedron_8c.html#a36">Polyhedron_Copy</a>(pol),polun);
00952                        <a class="code" href="polyhedron_8c.html#a18">Polyhedron_Free</a>(pol);
00953                        <a class="code" href="vector_8c.html#a6">Vector_Free</a>(NCont);
00954                                  <a class="code" href="arithmetique_8h.html#a14">value_clear</a>( val );
00955                     }
00956            }
00957           <font class="keywordflow">if</font>(polun==NULL) { <font class="comment">//  No constraint is added to input polyhedron</font>
00958               <font class="keywordflow">if</font>(emptyQ(D))<font class="keyword"> </font>{
00959                       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00960                       <font class="keywordflow">return</font> ((Enumeration *) 0);
00961               }
00962               <font class="keywordflow">else</font> {
00963                  ee= <a class="code" href="ext__ehrhart_8c.html#a19">Domain_Enumerate</a>(D,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>,par_name);
00964               }
00965           }
00966       <font class="keywordflow">else</font> { <font class="comment">// some constraintes are added to input polyhedron </font>
00967               <font class="keywordflow">if</font>(emptyQ(polun))<font class="keyword"></font>{
00968                       <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00969                       <font class="keywordflow">return</font> ((Enumeration *) 0);
00970               }
00971               <font class="keywordflow">else</font> {
00972         printf(<font class="stringliteral">"\n ##################################################################"</font>);       
00973         printf(<font class="stringliteral">"\n ****** THE RESULT OF ADDING CONSTRAINTS TO THE INPUT POLYHEDRON  ****** \n"</font>);         
00974                <a class="code" href="ext__ehrhart_8c.html#a17">AffConstraints</a>(polun);
00975                ee= <a class="code" href="ext__ehrhart_8c.html#a19">Domain_Enumerate</a>(polun,C,<a class="code" href="verif__ehrhart_8c.html#a0">MAXRAYS</a>,par_name);
00976                <a class="code" href="arithmetique_8h.html#a14">value_clear</a>(h);
00977                <font class="keywordflow">return</font> (ee );
00978               }
00979       }
00980               
00981 
00982         <font class="keywordflow">return</font>( NULL );           
00983 }
00984 
00985 
</pre></div><hr><address><small>Generated on Fri Oct 4 15:05:56 2002 for Polylib by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.11.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
