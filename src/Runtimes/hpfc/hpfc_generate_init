#! /bin/sh
#
# $RCSfile: hpfc_generate_init,v $ ($Date: 1996/08/30 14:29:41 $, )
# version $Revision$
# got on %D%, %T%
# $Id$
#
# generate the initialization file
#

script=`basename $0`
unset NAME 

usage()
{
  echo "Usage: $script [ -n name ] dirname" 1>&2
  exit 1
}

while getopts n: OPT
do
  case $OPT in
    n) NAME=$OPTARG ;;
    *) usage ;;
  esac
done

shift `expr $OPTIND - 1`

[ "$#" -eq 1 ] || usage

dirname=$1
init=$dirname/param_init.m4

NAME="${NAME:-`basename $dirname .database`}"
NAME=`echo $NAME | tr 'A-Z' 'a-z'`

# the key is used to check that the nodes and host do match...

key="${NAME}.`hostname`.`whoami`.`date +"%H.%M.%S.%j.%y"`"

{
  echo "      subroutine HPFC_INIT_COMMON_PARAM()"
  echo "      include \"hpfc_commons.h\""
  #
  # must avoid the hpfc_ version. 
  # pips generates uppercase file names...
  #
  for file in $dirname/[A-Z]*_parameters.h
  do
    echo "      include \"`basename $file`\""
  done
  for file in $dirname/*_init.h
  do
    echo "      include \"`basename $file`\""
  done
  echo "c other initializations"
  echo "      NODE_PROGRAM_NAME=\"${NAME}_node\""
  echo "      NODE_ARCHITECTURE=\"PVM_ARCHITECTURE\""
  echo "      HPFC_GROUP_NAME=\"${NAME}_group\""
  echo "      HPFC_KEY=\"$key\""
  echo "      end"
} > $init

hpfc_add_warning $init
